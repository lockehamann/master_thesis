

\chapter{GPU加速效果的影响因素}

本章在\ProgramName 程序的基础上，将讨论一些影响GPU加速效果的因素，
如系数矩阵存储格式、迭代算法的选择等。

\section{稀疏矩阵格式选择}

为了比较各种存储格式的速度，使用三维扩散临界计算程序来进行测试，
测试算例为三维IAEA基准题，各存储格式的计算时间见\floatref{tab:equsolve.spformat}及
\floatref{fig:equsolve.spformat}，
图中ML表示Multilevel方法、SP表示单精度、DP表示双精度。

结果显示，对于三维扩散方程，DIA和ELL格式明显优于CSR和COO格式，其中DIA性能最高。
这主要是因为DIA和ELL较为适合向量机型处理器的运算和内存访问方式，
而且较为适合有限差分方法离散得到的7对角线方程组，
其中DIA格式占用的空间最少。
在CG和BiCGStab计算中，矩阵参与的部分是稀疏矩阵-向量乘法（以下简称为SpMV），
SpMV在GPU上的主要瓶颈是显存带宽\cite{bell2008spmv,
baskaran2008optimizing}，所以DIA格式性能相对较好。

在其他应用中，还有很多基于分块的系数矩阵存储格式，可以更进一步地匹配问题的特点，
相对于单纯的使用某一种格式要好。但本文讨论的是结构网格离散的对角线矩阵，
分块格式相对于对角线DIA格式并没有明显的优势，
所以这里不再对分块系数矩阵存储格式进行讨论。

%\begin{sidewaystable}
%\pdfrotate
\begin{table}
\centering
\begin{minipage}{\linewidth}
\centering
\caption[不同稀疏矩阵格式求解三维临界扩散的时间表]
{\label{tab:equsolve.spformat}%
不同稀疏矩阵格式求解三维临界扩散的时间表(单位:s)
}
\small
\begin{tabular}{ccccccccc}
\toprule
 \multirow {3}{*}{矩阵格式}  &
       \multicolumn{4}{c}{网格大小$2.5^3\mathrm{cm}^3$}
       &\multicolumn{4}{c}{网格大小$1.25^3\mathrm{cm}^3$} \\
 &\multicolumn{2}{c}{CG\footnote{内迭代每轮18次，下同。}}
 	   &\multicolumn{2}{c}{BiCGStab\footnote{内迭代每轮30次，下同。}}
       & \multicolumn{2}{c}{CG}& \multicolumn{2}{c}{BiCGStab}\\
 & SP& DP& SP& DP& SP& DP& SP& DP\\
\midrule
 DIA&  5.475&  7.956& 12.199& 19.391& 24.071& 43.415&  64.256& 116.922\\
 ELL&  6.255&  8.596& 14.711& 20.997& 29.141& 47.362&  81.261& 133.599\\
 CSR& 10.452& 13.042& 27.814& 34.960& 62.478& 82.929& 180.430& 238.462\\
 COO& 11.232& 13.432& 30.934& 36.629& 64.303& 82.384& 197.263& 248.618\\
 DIA ML\footnote{粗网内迭代每轮10次，下同。}
       &  3.838&  4.883&  6.349&  8.003&  9.266& 14.976&  14.165&  31.590\\
 ELL ML&  4.399&  5.351&  7.363&  8.626& 10.920& 16.224&  17.503&  35.322\\
 CSR ML&  5.975&  6.989& 11.513& 14.337& 19.734& 26.301&  38.438&  61.776\\
 COO ML&  6.474&  7.660& 11.840& 13.712& 20.733& 26.364&  42.400&  65.910\\
\bottomrule
\end{tabular}
\end{minipage}
%\end{sidewaystable}
\end{table}

\begin{figure}
\centering
\includegraphics{equsolve-spformat}
\caption{\label{fig:equsolve.spformat}不同稀疏矩阵格式求解三维临界扩散的时间}
\end{figure}


\section{迭代算法选择}

为了比较不同迭代求解方法和预处理器的效果，这里仍然选择用IAEA基准题进行测试，
网格大小分别取5cm、2.5cm、2cm、1cm进行测试。
为了去除结果收敛精度的影响，这里对于每种情况反复调整程序的收敛参数使其结果
$K_\mathrm{eff}$和Citation的结果偏差刚好小于$5\times10^{-5}$，
在同样的结果收敛精度下比较各方法的时间。

选择的算法包括
\begin{enumerate}
\item Jacobi-SG，逐群使用Jacobi迭代进行求解。
\item Jacobi-MG，使用Jacobi对所有能群统一求解。
\item CG-SG，逐群使用CG迭代进行求解。
\item BiCGStab-MG，使用BiCGStab对所有能群统一求解。
\item GMRES-MG，使用GMRES对所有能群统一求解。
\end{enumerate}
以上算法中，除Jacobi-SG、Jacobi-MG外都使用对角线预处理算法。
这里测试使用单精度进行计算。

由于在临界计算的源迭代中一般在每步内迭代中精确求解方程组，
往往是迭代一个较少的次数，可以达到大幅减少计算时间的目的。
这个内迭代次数和问题的规模和迭代算法、预条件算法、初值的好坏都有关系，
如何根据问题规模选择最优的内迭代次数不在文本的讨论之内，
为了公平地比较各种算法，以下将分别寻找各种情况下最优的内迭代次数。

\subsection{Jacobi-SG}
\label{sec:equsolve.iter.jacobi-sg}

Jacobi-SG算法网格大小分别取5cm、2.5cm、2cm、1cm的计算结果
见\floatref{tab:equsolve.iter.jacobi-sg.5cm}、%
\floatref{tab:equsolve.iter.jacobi-sg.2.5cm}、%
\floatref{tab:equsolve.iter.jacobi-sg.2cm}和%
\floatref{tab:equsolve.iter.jacobi-sg.1cm}，
从表中可见最优的内迭代次数分别为7、11、16、18。

\begin{datasheet}
\sectionref{sec:equsolve.iter.jacobi-sg}的数据表：
\floatref{tab:equsolve.iter.jacobi-sg.5cm}、
\floatref{tab:equsolve.iter.jacobi-sg.2.5cm}、
\floatref{tab:equsolve.iter.jacobi-sg.2cm}、
\floatref{tab:equsolve.iter.jacobi-sg.1cm}
。

\begin{table}
\centering
\caption{5cm 网格时 Jacobi-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-sg.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 2.294 & 4724 & 1181\\
3 & 1.872 & 4818 & 803\\
4 & 1.778 & 4944 & 618\\
5 & 1.716 & 5090 & 509\\
6 & 1.732 & 5268 & 439\\
7 & 1.701 & 5446 & 389\\
8 & 1.732 & 5648 & 353\\
9 & 1.716 & 5850 & 325\\
10 & 1.748 & 6060 & 303\\
11 & 1.763 & 6270 & 285\\
12 & 1.794 & 6504 & 271\\
13 & 1.857 & 6734 & 259\\
14 & 1.888 & 6972 & 249\\
15 & 1.935 & 7200 & 240\\
16 & 1.982 & 7456 & 233\\
17 & 1.997 & 7684 & 226\\
18 & 2.028 & 7956 & 221\\
19 & 2.153 & 8208 & 216\\
20 & 2.138 & 8440 & 211\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2.5cm 网格时 Jacobi-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-sg.2.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 14.898 & 18064 & 4516\\
3 & 12.870 & 18096 & 3016\\
4 & 11.965 & 18136 & 2267\\
5 & 11.326 & 18190 & 1819\\
6 & 11.154 & 18264 & 1522\\
7 & 11.123 & 18340 & 1310\\
8 & 11.201 & 18432 & 1152\\
9 & 10.982 & 18522 & 1029\\
10 & 10.592 & 18640 & 932\\
11 & 10.406 & 18744 & 852\\
12 & 10.452 & 18888 & 787\\
13 & 10.437 & 19006 & 731\\
14 & 10.437 & 19152 & 684\\
15 & 10.608 & 19290 & 643\\
16 & 10.561 & 19456 & 608\\
17 & 10.624 & 19618 & 577\\
18 & 10.562 & 19764 & 549\\
19 & 10.686 & 19950 & 525\\
20 & 10.749 & 20120 & 503\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2cm 网格时 Jacobi-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-sg.2cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 33.899 & 27600 & 6900\\
3 & 30.560 & 27618 & 4603\\
4 & 28.704 & 27648 & 3456\\
5 & 27.503 & 27680 & 2768\\
6 & 26.910 & 27732 & 2311\\
7 & 26.645 & 27776 & 1984\\
8 & 26.583 & 27840 & 1740\\
9 & 26.162 & 27900 & 1550\\
10 & 25.896 & 27980 & 1399\\
11 & 25.849 & 28050 & 1275\\
12 & 26.006 & 28152 & 1173\\
13 & 25.693 & 28236 & 1086\\
14 & 25.615 & 28336 & 1012\\
15 & 25.724 & 28440 & 948\\
16 & 25.756 & 28576 & 893\\
17 & 25.678 & 28696 & 844\\
18 & 25.865 & 28800 & 800\\
19 & 25.803 & 28918 & 761\\
20 & 25.912 & 29080 & 727\\
\bottomrule
\end{tabular}
\end{table}


\begin{table}
\centering
\caption{1cm 网格时 Jacobi-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-sg.1cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 604.423 & 87288 & 21822 \\ %Fail:Solve Time exceeds 600.000
3 & 602.754 & 94824 & 15804 \\ %Fail:Solve Time exceeds 600.000
4 & 602.536 & 100728 & 12591 \\ %Fail:Solve Time exceeds 600.000
5 & 602.661 & 102770 & 10277 \\ %Fail:Solve Time exceeds 600.000
6 & 602.676 & 105792 & 8816 \\ %Fail:Solve Time exceeds 600.000
7 & 602.738 & 107352 & 7668 \\ %Fail:Solve Time exceeds 600.000
8 & 602.629 & 108544 & 6784 \\ %Fail:Solve Time exceeds 600.000
9 & 602.879 & 108288 & 6016 \\ %Fail:Solve Time exceeds 600.000
10 & 602.801 & 110180 & 5509 \\ %Fail:Solve Time exceeds 600.000
11 & 602.660 & 110176 & 5008 \\ %Fail:Solve Time exceeds 600.000
12 & 602.817 & 111408 & 4642 \\ %Fail:Solve Time exceeds 600.000
13 & 602.847 & 111020 & 4270 \\ %Fail:Solve Time exceeds 600.000
14 & 602.956 & 111020 & 3965 \\ %Fail:Solve Time exceeds 600.000
15 & 602.785 & 112560 & 3752 \\ %Fail:Solve Time exceeds 600.000
16 & 602.863 & 112896 & 3528 \\ %Fail:Solve Time exceeds 600.000
17 & 602.676 & 112302 & 3303 \\ %Fail:Solve Time exceeds 600.000
18 & 602.769 & 113364 & 3149 \\ %Fail:Solve Time exceeds 600.000
19 & 602.801 & 112822 & 2969 \\ %Fail:Solve Time exceeds 600.000
20 & 602.925 & 113760 & 2844 \\ %Fail:Solve Time exceeds 600.000
21 & 602.598 & 113022 & 2691 \\ %Fail:Solve Time exceeds 600.000
22 & 602.738 & 112992 & 2568 \\ %Fail:Solve Time exceeds 600.000
23 & 603.238 & 114264 & 2484 \\ %Fail:Solve Time exceeds 600.000
24 & 602.988 & 113520 & 2365 \\ %Fail:Solve Time exceeds 600.000
25 & 603.097 & 114550 & 2291 \\ %Fail:Solve Time exceeds 600.000
26 & 602.910 & 113672 & 2186 \\ %Fail:Solve Time exceeds 600.000
27 & 602.769 & 113832 & 2108 \\ %Fail:Solve Time exceeds 600.000
28 & 602.910 & 114688 & 2048 \\ %Fail:Solve Time exceeds 600.000
29 & 602.910 & 114086 & 1967 \\ %Fail:Solve Time exceeds 600.000
30 & 602.878 & 115080 & 1918 \\ %Fail:Solve Time exceeds 600.000
40 & 602.816 & 114880 & 1436 \\ %Fail:Solve Time exceeds 600.000
50 & 602.878 & 116100 & 1161 \\ %Fail:Solve Time exceeds 600.000
\bottomrule
\end{tabular}
\end{table}

\end{datasheet}


\subsection{Jacobi-MG}
\label{sec:equsolve.iter.jacobi-mg}

Jacobi-SG算法网格大小分别取5cm、2.5cm、2cm、1cm的计算结果
见\floatref{tab:equsolve.iter.jacobi-mg.5cm}、%
\floatref{tab:equsolve.iter.jacobi-mg.2.5cm}、%
\floatref{tab:equsolve.iter.jacobi-mg.2cm}和%
\floatref{tab:equsolve.iter.jacobi-mg.1cm}，
从中可见最优的内迭代次数分别为4\footnote{各迭代次数时间接近，这里取总内迭代次数最小的。}、8、11、38。

\begin{datasheet}
\sectionref{sec:equsolve.iter.jacobi-mg}的数据表：
\floatref{tab:equsolve.iter.jacobi-mg.5cm}、
\floatref{tab:equsolve.iter.jacobi-mg.2.5cm}、
\floatref{tab:equsolve.iter.jacobi-mg.2cm}、
\floatref{tab:equsolve.iter.jacobi-mg.1cm}
。

\begin{table}
\centering
\caption{5cm 网格时 Jacobi-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-mg.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-3 & \multicolumn{3}{c}{不收敛} \\ %Fail:PhiErr exceeds 10
4 & 1.420 & 2760 & 690\\
5 & 1.342 & 2845 & 569\\
6 & 1.326 & 2928 & 488\\
7 & 1.279 & 3017 & 431\\
8 & 1.295 & 3112 & 389\\
9 & 1.248 & 3204 & 356\\
10 & 1.264 & 3300 & 330\\
11 & 1.279 & 3399 & 309\\
12 & 1.295 & 3492 & 291\\
13 & 1.310 & 3601 & 277\\
14 & 1.326 & 3710 & 265\\
15 & 1.342 & 3810 & 254\\
16 & 1.357 & 3920 & 245\\
17 & 1.389 & 4046 & 238\\
18 & 1.404 & 4158 & 231\\
19 & 1.404 & 4275 & 225\\
20 & 1.451 & 4400 & 220\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2.5cm 网格时 Jacobi-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-mg.2.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-5 & \multicolumn{3}{c}{不收敛} \\ %Fail:PhiErr exceeds 10
6 & 29.734 & 29070 & 4845\\
7 & 12.246 & 12166 & 1738\\
8 & 9.657 & 9800 & 1225\\
9 & 9.672 & 9891 & 1099\\
10 & 9.625 & 9970 & 997\\
11 & 9.609 & 10065 & 915\\
12 & 9.563 & 10152 & 846\\
13 & 9.578 & 10231 & 787\\
14 & 9.641 & 10318 & 737\\
15 & 9.610 & 10410 & 694\\
16 & 9.625 & 10496 & 656\\
17 & 9.703 & 10591 & 623\\
18 & 9.750 & 10674 & 593\\
19 & 9.813 & 10773 & 567\\
20 & 9.843 & 10860 & 543\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2cm 网格时 Jacobi-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-mg.2cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-6 & \multicolumn{3}{c}{不收敛} \\ %Fail:PhiErr exceeds 10
7 & 176.671 & 98966 & 14138\\
8 & 63.258 & 36336 & 4542\\
9 & 37.534 & 21708 & 2412\\
10 & 25.303 & 14740 & 1474\\
11 & 25.241 & 14817 & 1347\\
12 & 25.256 & 14904 & 1242\\
13 & 25.319 & 14989 & 1153\\
14 & 25.319 & 15064 & 1076\\
15 & 25.381 & 15150 & 1010\\
16 & 25.397 & 15232 & 952\\
17 & 25.397 & 15317 & 901\\
18 & 25.569 & 15408 & 856\\
19 & 25.646 & 15504 & 816\\
20 & 25.694 & 15580 & 779\\
\bottomrule
\end{tabular}
\end{table}


\begin{table}
\centering
\caption{1cm 网格时 Jacobi-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.jacobi-mg.1cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-31(超时) & >600 & -- & -- \\ %Fail:Solve Time exceeds 600.000
2 & 602.676 & 44126 & 22063 \\ %Fail:Solve Time exceeds 600.000
3 & 602.739 & 48057 & 16019 \\ %Fail:Solve Time exceeds 600.000
4 & 602.770 & 49912 & 12478 \\ %Fail:Solve Time exceeds 600.000
5 & 602.785 & 51505 & 10301 \\ %Fail:Solve Time exceeds 600.000
6 & 602.739 & 52434 & 8739 \\ %Fail:Solve Time exceeds 600.000
7 & 602.769 & 53130 & 7590 \\ %Fail:Solve Time exceeds 600.000
8 & 602.707 & 53680 & 6710 \\ %Fail:Solve Time exceeds 600.000
9 & 602.598 & 53874 & 5986 \\ %Fail:Solve Time exceeds 600.000
10 & 602.785 & 54320 & 5432 \\ %Fail:Solve Time exceeds 600.000
11 & 604.221 & 52767 & 4797 \\ %Fail:Solve Time exceeds 600.000
12 & 602.692 & 53268 & 4439 \\ %Fail:Solve Time exceeds 600.000
13 & 602.644 & 53261 & 4097 \\ %Fail:Solve Time exceeds 600.000
14 & 602.879 & 53564 & 3826 \\ %Fail:Solve Time exceeds 600.000
15 & 602.645 & 53550 & 3570 \\ %Fail:Solve Time exceeds 600.000
16 & 602.676 & 53920 & 3370 \\ %Fail:Solve Time exceeds 600.000
17 & 602.723 & 53771 & 3163 \\ %Fail:Solve Time exceeds 600.000
18 & 602.785 & 54144 & 3008 \\ %Fail:Solve Time exceeds 600.000
19 & 602.629 & 54036 & 2844 \\ %Fail:Solve Time exceeds 600.000
20 & 602.738 & 54080 & 2704 \\ %Fail:Solve Time exceeds 600.000
21 & 602.894 & 53823 & 2563 \\ %Fail:Solve Time exceeds 600.000
22 & 602.738 & 53900 & 2450 \\ %Fail:Solve Time exceeds 600.000
23 & 602.926 & 54188 & 2356 \\ %Fail:Solve Time exceeds 600.000
24 & 602.817 & 54024 & 2251 \\ %Fail:Solve Time exceeds 600.000
25 & 602.832 & 54250 & 2170 \\ %Fail:Solve Time exceeds 600.000
26 & 602.895 & 54184 & 2084 \\ %Fail:Solve Time exceeds 600.000
27 & 602.801 & 54189 & 2007 \\ %Fail:Solve Time exceeds 600.000
28 & 602.956 & 54152 & 1934 \\ %Fail:Solve Time exceeds 600.000
29 & 602.801 & 54462 & 1878 \\ %Fail:Solve Time exceeds 600.000
30 & 602.817 & 54300 & 1810 \\ %Fail:Solve Time exceeds 600.000
40 & 602.895 & 54720 & 1368 \\ %Fail:Solve Time exceeds 600.000
50 & 603.129 & 55250 & 1105 \\ %Fail:Solve Time exceeds 600.000
\bottomrule
\end{tabular}
\end{table}

\end{datasheet}


\subsection{CG-SG}
\label{sec:equsolve.iter.cg-sg}

CG-SG算法网格大小分别取5cm、2.5cm、2cm、1cm的计算结果
见\floatref{fig:equsolve.iter.cg-sg}，
原始数据表及各次结果的总内迭代次数、外迭代次数见
\floatref{tab:equsolve.iter.cg-sg.5cm}、%
\floatref{tab:equsolve.iter.cg-sg.2.5cm}、%
\floatref{tab:equsolve.iter.cg-sg.2cm}和%
\floatref{tab:equsolve.iter.cg-sg.1cm}，
从中可见最优的内迭代次数分别为4、7、10、17。

\begin{figure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={2,3,4,5,6,8,10,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks={major={at={1,1.5,2,2.5}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  2 , 1.576 , 1960 , 490
  3 , 1.046 , 1464 , 244
  4 , 0.920 , 1472 , 184
  5 , 1.092 , 1840 , 184
  6 , 1.186 , 2196 , 183
  7 , 1.342 , 2562 , 183
  8 , 1.467 , 2912 , 182
  9 , 1.622 , 3276 , 182
  10 , 1.685 , 3640 , 182
  11 , 1.841 , 3988 , 182
  12 , 1.966 , 4305 , 182
  13 , 2.138 , 4595 , 182
  14 , 2.246 , 4869 , 182
  15 , 2.450 , 5124 , 182
  16 , 2.372 , 5362 , 182
  17 , 2.512 , 5576 , 182
  18 , 2.559 , 5746 , 182
  19 , 2.684 , 5888 , 182
  20 , 2.792 , 6009 , 182
  };
\end{tikzpicture}
\caption{5cm网格}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={2,3,4,5,7,10,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks={major={at={3,5,7,10}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  2, 9.999, 7472, 1868
  3, 5.694, 4740, 790
  4, 3.837, 3504, 438
  5, 3.120, 2910, 291
  6, 2.855, 2856, 238
  7, 2.761, 2800, 200
  8, 2.792, 2960, 185
  9, 3.042, 3312, 184
  10, 3.385, 3680, 184
  11, 3.572, 4026, 183
  12, 3.947, 4392, 183
  13, 4.181, 4758, 183
  14, 4.493, 5096, 182
  15, 4.727, 5460, 182
  16, 5.070, 5824, 182
  17, 5.460, 6188, 182
  18, 5.787, 6552, 182
  19, 5.912, 6916, 182
  20, 6.146, 7280, 182
  };
\end{tikzpicture}
\caption{2.5cm网格}
\end{subfigure}
\\[1cm]
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={2,3,4,5,8,10,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks={major={at={6,8,10,15,20}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  2, 23.384, 10940, 2735
  3, 13.260, 7410, 1235
  4, 9.048, 5528, 691
  5, 6.927, 4390, 439
  6, 6.068, 3864, 322
  7, 5.757, 3808, 272
  8, 5.367, 3696, 231
  9, 5.726, 3924, 218
  10, 5.476, 3700, 185
  11, 5.897, 4048, 184
  12, 6.396, 4416, 184
  13, 6.739, 4784, 184
  14, 7.067, 5124, 183
  15, 7.395, 5490, 183
  16, 7.831, 5856, 183
  17, 8.611, 6222, 183
  18, 8.939, 6588, 183
  19, 8.939, 6916, 182
  20, 9.376, 7280, 182
  };
\end{tikzpicture}
\caption{2cm网格}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={2,3,4,5,10,17,40}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks=many, ticks={major={at={50,100,200,400}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  2, 445.958, 43336, 10834
  3, 252.955, 28458, 4743
  4, 186.670, 22616, 2827
  5, 141.945, 18000, 1800
  6, 113.818, 14928, 1244
  7, 93.303, 12558, 897
  8, 78.983, 10784, 674
  9, 69.108, 9594, 533
  10, 60.591, 8480, 424
  11, 61.776, 8580, 390
  12, 53.102, 7536, 314
  13, 56.269, 8034, 309
  14, 50.981, 7336, 262
  15, 51.839, 7500, 250
  16, 50.357, 7200, 225
  17, 48.875, 7106, 209
  18, 52.806, 7740, 215
  19, 49.093, 7106, 187
  20, 50.216, 7400, 185
  21, 52.416, 7770, 185
  22, 55.785, 8140, 185
  23, 57.002, 8464, 184
  24, 59.521, 8832, 184
  25, 61.932, 9200, 184
  26, 64.849, 9568, 184
  27, 66.019, 9882, 183
  28, 68.266, 10248, 183
  29, 70.855, 10614, 183
  30, 73.710, 10980, 183
  31, 74.802, 11346, 183
  32, 77.703, 11712, 183
  33, 79.654, 12078, 183
  34, 83.226, 12444, 183
  35, 84.521, 12810, 183
  36, 87.953, 13176, 183
  37, 88.967, 13542, 183
  38, 92.149, 13832, 182
  39, 94.302, 14196, 182
  40, 96.642, 14560, 182
  };
\end{tikzpicture}
\caption{1cm网格}
\end{subfigure}
\caption{CG-SG 不同内迭代次数的计算时间\label{fig:equsolve.iter.cg-sg}}
\end{figure}

\begin{datasheet}
\sectionref{sec:equsolve.iter.cg-sg}的数据表：
\floatref{tab:equsolve.iter.cg-sg.5cm}、
\floatref{tab:equsolve.iter.cg-sg.2.5cm}、
\floatref{tab:equsolve.iter.cg-sg.2cm}、
\floatref{tab:equsolve.iter.cg-sg.1cm}
。

\begin{table}
\centering
\caption{5cm 网格时 CG-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.cg-sg.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 1.841 & 2252 & 563\\
3 & 1.124 & 1470 & 245\\
4 & 0.983 & 1384 & 173\\
5 & 1.155 & 1740 & 174\\
6 & 1.326 & 2076 & 173\\
7 & 1.404 & 2422 & 173\\
8 & 1.544 & 2768 & 173\\
9 & 1.716 & 3096 & 172\\
10 & 1.779 & 3440 & 172\\
11 & 1.950 & 3778 & 172\\
12 & 2.059 & 4085 & 172\\
13 & 2.153 & 4365 & 172\\
14 & 2.216 & 4631 & 172\\
15 & 2.371 & 4874 & 172\\
16 & 2.450 & 5102 & 172\\
17 & 2.512 & 5314 & 172\\
18 & 2.543 & 5486 & 172\\
19 & 2.668 & 5628 & 172\\
20 & 2.746 & 5749 & 172\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2.5cm 网格时 CG-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.cg-sg.2.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 11.872 & 8632 & 2158\\
3 & 6.552 & 5520 & 920\\
4 & 4.556 & 4088 & 511\\
5 & 3.557 & 3350 & 335\\
6 & 3.089 & 2976 & 248\\
7 & 2.839 & 2786 & 199\\
8 & 2.793 & 2816 & 176\\
9 & 3.058 & 3168 & 176\\
10 & 3.339 & 3520 & 176\\
11 & 3.573 & 3872 & 176\\
12 & 3.838 & 4200 & 175\\
13 & 4.088 & 4550 & 175\\
14 & 4.400 & 4900 & 175\\
15 & 4.633 & 5250 & 175\\
16 & 4.883 & 5568 & 174\\
17 & 5.117 & 5916 & 174\\
18 & 5.398 & 6264 & 174\\
19 & 5.679 & 6612 & 174\\
20 & 5.975 & 6960 & 174\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2cm 网格时 CG-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.cg-sg.2cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & 25.366 & 12412 & 3103\\
3 & 15.023 & 8388 & 1398\\
4 & 10.265 & 6288 & 786\\
5 & 7.832 & 4980 & 498\\
6 & 6.490 & 4212 & 351\\
7 & 5.710 & 3850 & 275\\
8 & 5.351 & 3632 & 227\\
9 & 4.914 & 3384 & 188\\
10 & 4.945 & 3460 & 173\\
11 & 5.367 & 3806 & 173\\
12 & 5.757 & 4152 & 173\\
13 & 6.178 & 4498 & 173\\
14 & 6.537 & 4816 & 172\\
15 & 6.802 & 5160 & 172\\
16 & 7.363 & 5504 & 172\\
17 & 7.785 & 5848 & 172\\
18 & 8.159 & 6192 & 172\\
19 & 8.408 & 6536 & 172\\
20 & 9.048 & 6880 & 172\\
\bottomrule
\end{tabular}
\end{table}


\begin{table}
\centering
\caption{1cm 网格时 CG-SG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.cg-sg.1cm}
\small
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2(超时) & >600 & >57148 & >14287 \\ %Fail:Solve Time exceeds 600.000
3 & 346.851 & 39186 & 6531\\
4 & 251.941 & 30632 & 3829\\
5 & 195.796 & 24400 & 2440\\
6 & 155.657 & 20184 & 1682\\
7 & 128.497 & 17038 & 1217\\
8 & 108.966 & 14704 & 919\\
9 & 94.068 & 13086 & 727\\
10 & 82.665 & 11620 & 581\\
11 & 75.987 & 10780 & 490\\
12 & 70.356 & 10056 & 419\\
13 & 66.471 & 9542 & 367\\
14 & 63.461 & 9128 & 326\\
15 & 60.372 & 8760 & 292\\
16 & 57.720 & 8416 & 263\\
17 & 55.645 & 8126 & 239\\
18 & 53.758 & 7884 & 219\\
19 & 52.728 & 7752 & 204\\
20 & 54.147 & 8000 & 200\\
21 & 56.581 & 8400 & 200\\
22 & 59.155 & 8800 & 200\\
23 & 61.745 & 9200 & 200\\
24 & 64.366 & 9600 & 200\\
25 & 67.189 & 10000 & 200\\
26 & 69.311 & 10400 & 200\\
27 & 71.479 & 10746 & 199\\
28 & 73.960 & 11144 & 199\\
29 & 76.752 & 11542 & 199\\
30 & 78.890 & 11940 & 199\\
40 & 105.113 & 15840 & 198\\
50 & 130.447 & 19800 & 198\\
\bottomrule
\end{tabular}
\end{table}

\end{datasheet}

\subsection{BiCGStab-MG}
\label{sec:equsolve.iter.bicgstab-mg}

BiCGStab-MG算法网格大小分别取5cm、2.5cm、2cm、1cm的计算结果
见\floatref{fig:equsolve.iter.bicgstab-mg}，
原始数据表及各次结果的总内迭代次数、外迭代次数见
\floatref{tab:equsolve.iter.bicgstab-mg.5cm}、%
\floatref{tab:equsolve.iter.bicgstab-mg.2.5cm}、%
\floatref{tab:equsolve.iter.bicgstab-mg.2cm}和%
\floatref{tab:equsolve.iter.bicgstab-mg.1cm}，
从中可见最优的内迭代次数分别为3、8、10、21。

\begin{figure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={3,4,5,7,10,14,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks=many, ticks={major={at={1,2,3,4}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  3, 0.998, 624, 208
  4, 1.108, 752, 188
  5, 1.264, 915, 183
  6, 1.419, 1086, 181
  7, 1.607, 1267, 181
  8, 1.763, 1448, 181
  9, 1.919, 1629, 181
  10, 2.091, 1820, 182
  11, 2.340, 2013, 183
  12, 2.434, 2160, 180
  13, 2.589, 2366, 182
  14, 2.777, 2548, 182
  15, 2.980, 2730, 182
  16, 3.214, 2912, 182
  17, 3.292, 3094, 182
  18, 3.448, 3276, 182
  19, 3.572, 3458, 182
  20, 3.869, 3640, 182
  };
\end{tikzpicture}
\caption{5cm网格}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={7,8,10,14,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks=many, ticks={major={at={4,5,6,8}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  7, 4.181, 1638, 234
  8, 4.056, 1600, 200
  9, 4.134, 1647, 183
  10, 4.446, 1800, 180
  11, 4.898, 1991, 181
  12, 5.132, 2124, 177
  13, 5.445, 2275, 175
  14, 5.834, 2450, 175
  15, 6.194, 2625, 175
  16, 6.521, 2800, 175
  17, 6.942, 2992, 176
  18, 7.332, 3186, 177
  19, 7.894, 3401, 179
  20, 8.222, 3600, 180
  };
\end{tikzpicture}
\caption{2.5cm网格}
\end{subfigure}
\\[1cm]
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={9,10,12,14,17,20}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks=many, ticks={major={at={9,10,12,14}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  9, 10.250, 2412, 268
  10, 8.954, 2120, 212
  11, 9.360, 2233, 203
  12, 9.313, 2232, 186
  13, 9.641, 2301, 177
  14, 10.452, 2534, 181
  15, 10.857, 2655, 177
  16, 11.388, 2784, 174
  17, 11.840, 2941, 173
  18, 12.527, 3114, 173
  19, 13.292, 3287, 173
  20, 13.900, 3460, 173
  };
\end{tikzpicture}
\caption{2cm网格}
\end{subfigure}
\begin{subfigure}{.5\textwidth}
\centering
\begin{tikzpicture}
\datavisualization
  [scientific axes,
   visualize as line,
   x axis={ ticks={major={at={19,21,24,27,30}}},
            logarithmic, attribute=maxiter,
            label={内迭代次数} },
   y axis={ ticks=many, ticks={major={at={100,150,200,250}}},
            logarithmic, attribute=time,
            label={计算时间/s} }
   ]
  data {
  maxiter, time, inner, outter
  19, 258.804, 11134, 586
  20, 154.456, 6580, 329
  21, 100.339, 4305, 205
  22, 105.627, 4554, 207
  23, 106.673, 4554, 198
  24, 107.936, 4656, 194
  25, 109.965, 4725, 189
  26, 115.472, 4992, 192
  27, 112.991, 4887, 181
  28, 120.354, 5180, 185
  29, 124.020, 5336, 184
  30, 129.511, 5580, 186
  };
\end{tikzpicture}
\caption{1cm网格}
\end{subfigure}
\caption{BiCGStab-MG 不同内迭代次数的计算时间\label{fig:equsolve.iter.bicgstab-mg}}
\end{figure}

\begin{datasheet}
\sectionref{sec:equsolve.iter.bicgstab-mg}的数据表：
\floatref{tab:equsolve.iter.bicgstab-mg.5cm}、
\floatref{tab:equsolve.iter.bicgstab-mg.2.5cm}、
\floatref{tab:equsolve.iter.bicgstab-mg.2cm}、
\floatref{tab:equsolve.iter.bicgstab-mg.1cm}
。

\begin{table}
\centering
\caption{5cm 网格时 BiCGStab-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.bicgstab-mg.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2 & \multicolumn{3}{c}{不收敛} \\  %Fail:KeffErr exceeds 10
3 & 1.030 & 639 & 213\\
4 & 1.076 & 728 & 182\\
5 & 1.201 & 875 & 175\\
6 & 1.357 & 1032 & 172\\
7 & 1.513 & 1204 & 172\\
8 & 1.685 & 1376 & 172\\
9 & 1.826 & 1548 & 172\\
10 & 1.982 & 1720 & 172\\
11 & 2.168 & 1903 & 173\\
12 & 2.325 & 2064 & 172\\
13 & 2.512 & 2236 & 172\\
14 & 2.668 & 2422 & 173\\
15 & 2.792 & 2580 & 172\\
16 & 2.948 & 2752 & 172\\
17 & 3.120 & 2924 & 172\\
18 & 3.307 & 3096 & 172\\
19 & 3.417 & 3268 & 172\\
20 & 3.572 & 3440 & 172\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2.5cm 网格时 BiCGStab-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.bicgstab-mg.2.5cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6(超时) & >600 & >223518 & >37253 \\ %Fail:Solve Time exceeds 600.000
7 & 3.885 & 1512 & 216\\
8 & 4.196 & 1656 & 207\\
9 & 4.290 & 1728 & 192\\
10 & 4.602 & 1850 & 185\\
11 & 4.773 & 1947 & 177\\
12 & 4.914 & 2040 & 170\\
13 & 5.211 & 2171 & 167\\
14 & 5.523 & 2310 & 165\\
15 & 5.850 & 2475 & 165\\
16 & 6.318 & 2656 & 166\\
17 & 6.599 & 2822 & 166\\
18 & 7.067 & 3024 & 168\\
19 & 7.535 & 3230 & 170\\
20 & 7.972 & 3440 & 172\\
\bottomrule
\end{tabular}
\end{table}

\begin{table}
\centering
\caption{2cm 网格时 BiCGStab-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.bicgstab-mg.2cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-7 & \multicolumn{3}{c}{不收敛} \\ %\footnote{Fail:Nan: KeffErr, PhiErr, }
8(超时) & >600 & >142808 & >17851 \\ %Fail:Solve Time exceeds 600.000
9 & 8.096 & 1926 & 214\\
10 & 8.611 & 2060 & 206\\
11 & 9.219 & 2222 & 202\\
12 & 9.033 & 2196 & 183\\
13 & 9.906 & 2418 & 186\\
14 & 9.938 & 2436 & 174\\
15 & 10.155 & 2505 & 167\\
16 & 10.515 & 2608 & 163\\
17 & 11.045 & 2737 & 161\\
18 & 11.481 & 2880 & 160\\
19 & 11.965 & 3040 & 160\\
20 & 12.777 & 3220 & 161\\
\bottomrule
\end{tabular}
\end{table}


\begin{table}
\centering
\caption{1cm 网格时 BiCGStab-MG 不同内迭代次数的计算时间及总迭代次数}
\label{tab:equsolve.iter.bicgstab-mg.1cm}
\begin{tabular}{cccc}
\toprule
内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
2-17 & \multicolumn{3}{c}{不收敛} \\ %Fail:Nan: KeffErr, PhiErr,
18(超时) & >600 & >25434 & >1413 \\ %Fail:Solve Time exceeds 600.000
19 & 258.103 & 11134 & 586\\
20 & 149.386 & 6440 & 322\\
21 & 118.935 & 5061 & 241\\
22 & 122.164 & 5214 & 237\\
23 & 124.644 & 5313 & 231\\
24 & 125.409 & 5424 & 226\\
25 & 131.243 & 5625 & 225\\
26 & 135.643 & 5876 & 226\\
27 & 133.209 & 5778 & 214\\
28 & 137.982 & 5992 & 214\\
29 & 139.542 & 6061 & 209\\
30 & 141.648 & 6150 & 205\\
40 & 176.530 & 7720 & 193\\
50 & 222.298 & 9750 & 195\\
\bottomrule
\end{tabular}
\end{table}

\end{datasheet}

\subsection{GMRES-MG}
GMRES在实际计算中由于浮点精度问题一般会增加再启动步骤，
相对于前面的迭代算法增加了每隔多少次迭代进行再启动的参数，以下简记为Restart，
这里Restart分别取5、10、15进行计算，
计算结果见\floatref{tab:equsolve.iter.gmres}及
\floatref{fig:fig:equsolve.iter.gmres}。

\begin{figure}
\centering
\subcaptionbox{5cm网格}
{\includegraphics[scale=0.8]{equsolve-iter-gmres-5cm}}
\subcaptionbox{2.5cm网格}
{\includegraphics[scale=0.8]{equsolve-iter-gmres-2-5cm}}
\\[1cm]
\subcaptionbox{2cm网格}
{\includegraphics[scale=0.8]{equsolve-iter-gmres-2cm}}
\subcaptionbox{1cm网格}
{\includegraphics[scale=0.8]{equsolve-iter-gmres-1cm}}
\caption{\label{fig:fig:equsolve.iter.gmres}GMRES算法计算时间}
\end{figure}

\begin{table}
\centering
\caption{\label{tab:equsolve.iter.gmres}GMRES算法在不同参数下的最优内迭代次数及结果}
\begin{tabular}{cccccc}
\toprule
网格大小 & Restart & 最优内迭代次数 & 计算时间/s & 总内迭代次数 & 外迭代次数\\
\midrule
\multirow{3}{*}{5cm}
 & 5 & 6 & 1.092 & 1218 & 203\\
 & 10 & 6 & 1.077 & 1200 & 200\\
 & 15 & 6 & 1.077 & 1200 & 200\\
\multirow{3}{*}{2.5cm}
 & 5 & 11 & 5.273 & 2827 & 257\\
 & 10 & 11 & 5.850 & 2464 & 224\\
 & 15 & 11 & 5.944 & 2365 & 215\\
\multirow{3}{*}{2cm}
 & 5 & 17 & 12.339 & 4097 & 241\\
 & 10 & 15 & 11.653 & 3240 & 216\\
 & 15 & 14 & 13.354 & 2926 & 209\\
\multirow{3}{*}{1cm}
 & 5 & 28 & 343.310 & 19544 & 698\\
 & 10 & 28 & 228.166 & 10696 & 382\\
 & 15 & 27 & 194.049 & 7641 & 283\\
\bottomrule
\end{tabular}
\end{table}

%原始数据
\begin{comment}
res_gmres_size5.0_*_restart5*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & 1.217 & 1330 & 266\\
6 & 1.092 & 1218 & 203\\
7 & 1.186 & 1351 & 193\\
8 & 1.264 & 1464 & 183\\
9 & 1.326 & 1593 & 177\\
10 & 1.388 & 1720 & 172\\
11 & 1.513 & 1892 & 172\\
12 & 1.638 & 2088 & 174\\
13 & 1.748 & 2288 & 176\\
14 & 1.872 & 2464 & 176\\
15 & 2.169 & 2625 & 175\\
16 & 2.106 & 2800 & 175\\
17 & 2.247 & 2958 & 174\\
18 & 2.325 & 3114 & 173\\
19 & 2.481 & 3268 & 172\\
20 & 2.980 & 3440 & 172\\

res_gmres_size5.0_*_restart10*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & 1.264 & 1330 & 266\\
6 & 1.077 & 1200 & 200\\
7 & 1.170 & 1260 & 180\\
8 & 1.358 & 1408 & 176\\
9 & 1.576 & 1566 & 174\\
10 & 1.716 & 1730 & 173\\
11 & 1.856 & 1903 & 173\\
12 & 1.903 & 2076 & 173\\
13 & 2.012 & 2262 & 174\\
14 & 2.106 & 2436 & 174\\
15 & 2.372 & 2610 & 174\\
16 & 2.605 & 2768 & 173\\
17 & 2.590 & 2924 & 172\\
18 & 2.855 & 3096 & 172\\
19 & 2.933 & 3268 & 172\\
20 & 3.775 & 3440 & 172\\

res_gmres_size5.0_*_restart15*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & 1.233 & 1330 & 266\\
6 & 1.077 & 1200 & 200\\
7 & 1.170 & 1260 & 180\\
8 & 1.326 & 1408 & 176\\
9 & 1.514 & 1566 & 174\\
10 & 1.732 & 1730 & 173\\
11 & 1.950 & 1903 & 173\\
12 & 2.231 & 2076 & 173\\
13 & 2.528 & 2249 & 173\\
14 & 2.948 & 2422 & 173\\
15 & 3.245 & 2595 & 173\\
16 & 3.276 & 2768 & 173\\
17 & 3.323 & 2924 & 172\\
18 & 3.868 & 3096 & 172\\
19 & 3.978 & 3268 & 172\\
20 & 3.635 & 3440 & 172\\

res_gmres_size2.5_*_restart5*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & 7.176 & 3942 & 438\\
10 & 5.492 & 2970 & 297\\
11 & 5.273 & 2827 & 257\\
12 & 5.320 & 2940 & 245\\
13 & 5.397 & 2990 & 230\\
14 & 5.741 & 3150 & 225\\
15 & 6.225 & 3420 & 228\\
16 & 6.147 & 3360 & 210\\
17 & 6.350 & 3536 & 208\\
18 & 6.692 & 3762 & 209\\
19 & 7.129 & 3990 & 210\\
20 & 7.348 & 4120 & 206\\

res_gmres_size2.5_*_restart10*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & 7.285 & 3020 & 302\\
11 & 5.850 & 2464 & 224\\
12 & 5.866 & 2580 & 215\\
13 & 5.975 & 2678 & 206\\
14 & 6.100 & 2758 & 197\\
15 & 6.350 & 2880 & 192\\
16 & 6.567 & 2976 & 186\\
17 & 6.864 & 3094 & 182\\
18 & 7.223 & 3204 & 178\\
19 & 7.660 & 3344 & 176\\
20 & 8.159 & 3480 & 174\\

res_gmres_size2.5_*_restart15*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & 7.254 & 3020 & 302\\
11 & 5.944 & 2365 & 215\\
12 & 6.334 & 2424 & 202\\
13 & 6.818 & 2483 & 191\\
14 & 7.348 & 2562 & 183\\
15 & 8.065 & 2700 & 180\\
16 & 8.330 & 2864 & 179\\
17 & 8.596 & 3043 & 179\\
18 & 8.783 & 3222 & 179\\
19 & 9.080 & 3382 & 178\\
20 & 9.360 & 3560 & 178\\

res_gmres_size2.0_*_restart5*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & 16.396 & 5424 & 452\\
13 & 14.103 & 4732 & 364\\
14 & 13.119 & 4368 & 312\\
15 & 15.397 & 5085 & 339\\
16 & 13.119 & 4320 & 270\\
17 & 12.339 & 4097 & 241\\
18 & 13.010 & 4356 & 242\\
19 & 13.822 & 4674 & 246\\
20 & 14.492 & 4860 & 243\\

res_gmres_size2.0_*_restart10*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
13 & 18.345 & 5096 & 392\\
14 & 12.652 & 3528 & 252\\
15 & 11.653 & 3240 & 216\\
16 & 11.810 & 3328 & 208\\
17 & 12.402 & 3400 & 200\\
18 & 12.746 & 3456 & 192\\
19 & 13.058 & 3515 & 185\\
20 & 13.806 & 3640 & 182\\

res_gmres_size2.0_*_restart15*
2 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
3 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
13 & 13.759 & 3094 & 238\\
14 & 13.354 & 2926 & 209\\
15 & 14.274 & 2985 & 199\\
16 & 14.289 & 3104 & 194\\
17 & 14.711 & 3264 & 192\\
18 & 14.758 & 3402 & 189\\
19 & 15.069 & 3534 & 186\\
20 & 15.476 & 3640 & 182\\

res_gmres_size1.0_*_restart5*
2 & 602.676 & 27800 & 13900 \\ %Fail:Solve Time exceeds 600.000
3 & 602.707 & 30585 & 10195 \\ %Fail:Solve Time exceeds 600.000
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
13 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
14 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
15 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
16 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
17 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
18 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
19 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
20 & 602.910 & 33700 & 1685 \\ %Fail:Solve Time exceeds 600.000
21 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
22 & 602.879 & 33506 & 1523 \\ %Fail:Solve Time exceeds 600.000
23 & 602.754 & 33971 & 1477 \\ %Fail:Solve Time exceeds 600.000
24 & 603.019 & 33744 & 1406 \\ %Fail:Solve Time exceeds 600.000
25 & 602.988 & 33850 & 1354 \\ %Fail:Solve Time exceeds 600.000
26 & 603.081 & 33644 & 1294 \\ %Fail:Solve Time exceeds 600.000
27 & 506.502 & 28377 & 1051\\
28 & 343.310 & 19544 & 698\\
29 & 360.829 & 20561 & 709\\
30 & 388.379 & 21750 & 725\\
40 & 376.601 & 21240 & 531\\
50 & 397.161 & 22450 & 449\\

res_gmres_size1.0_*_restart10*
2 & 602.660 & 26664 & 13332 \\ %Fail:Solve Time exceeds 600.000
3 & 602.660 & 29667 & 9889 \\ %Fail:Solve Time exceeds 600.000
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
13 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
14 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
15 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
16 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
17 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
18 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
19 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
20 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
21 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
22 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
23 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
24 & 602.863 & 28392 & 1183 \\ %Fail:Solve Time exceeds 600.000
25 & 367.428 & 17275 & 691\\
26 & 398.175 & 18694 & 719\\
27 & 237.698 & 11232 & 416\\
28 & 228.166 & 10696 & 382\\
29 & 245.716 & 11397 & 393\\
30 & 269.209 & 12180 & 406\\
40 & 260.255 & 11840 & 296\\
50 & 291.642 & 13300 & 266\\

res_gmres_size1.0_*_restart15*
2 & 602.832 & 25838 & 12919 \\ %Fail:Solve Time exceeds 600.000
3 & 602.613 & 28776 & 9592 \\ %Fail:Solve Time exceeds 600.000
4 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
5 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
6 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
7 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
8 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
9 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
10 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
11 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
12 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
13 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
14 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
15 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
16 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
17 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
18 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
19 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
20 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
21 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
22 & \multicolumn{3}{c}{不收敛} \\ %Fail:KeffErr exceeds 10
23 & 603.004 & 24196 & 1052 \\ %Fail:Solve Time exceeds 600.000
24 & 603.004 & 24144 & 1006 \\ %Fail:Solve Time exceeds 600.000
25 & 209.805 & 8350 & 334\\
26 & 201.365 & 8008 & 308\\
27 & 194.049 & 7641 & 283\\
28 & 202.005 & 7840 & 280\\
29 & 215.842 & 8149 & 281\\
30 & 228.977 & 8490 & 283\\
40 & 237.385 & 9280 & 232\\
50 & 290.098 & 11150 & 223\\
\end{comment}

\subsection{不同迭代算法对比}

以上各种迭代算法的最优参数及计算结果见\floatref{tab:equsolve.iter.compare}。

传统的Jacobi算法的速度最慢。
对比Jacobi-SG和Jacobi-MG方法会发现，
把各能群联合求解的Jacobi-MG明显要比逐群求解的Jacobi-SG方法要快，
Jacobi-MG快的主要因素之一是总内迭代次数较小，
大约只有Jacobi-SG方法的一半，
这是因为Jacobi-SG方法需要对2群分别进行迭代，
而Jacobi-MG方法迭代的矩阵阶数是Jacobi-SG方法的2倍，
由于迭代矩阵是对角线系数矩阵，所以每次迭代的计算量也后者的2倍，
所以总的计算量Jacobi-SG方法和Jacobi-MG方法接近。
但两者的计算时间却有较大差别，
这主要是因为这里使用的处理器是GPU，
和CPU不同GPU上程序的运行时间并不和计算量成正比，而是由如下部分组成
\begin{align}
  t_\mathrm{gpu,total} = t_\mathrm{init} + t_\mathrm{data} + t_\mathrm{calc} + t_\mathrm{sync}
\end{align}
其中$t_\mathrm{init}$是调用一个GPU函数所需要的启动时间，
这个时间一般相对固定，和计算量无关；
$t_\mathrm{data}$是从CPU向GPU传送数据的时间，
一般随CPU-GPU间通讯的数据量增加而线性增长；
$t_\mathrm{calc}$是GPU函数实际在GPU上执行的时间，和计算量有关；
$t_\mathrm{sync}$是GPU函数内及CPU-GPU间的同步等待时间，
和程序的行为模式有关。
由于Jacobi-MG方法的总内迭代次数较少，
所以在$t_\mathrm{init}$、$t_\mathrm{sync}$部分上的开销也相对较少。
对于GPU本身来说计算量越大越有优势，
即$t_\mathrm{MG,calc}<2t_\mathrm{SG,calc}$。
以上各种原因最终导致Jacobi-MG方法由于Jacobi-SG方法。

CG-SG方法在本测试中表现最好，和CG-SG方法同源的BiCGStab-MG方法和
前者的关系类似于Jacobi-SG和Jacobi-MG的关系，
结果显示BiCGStab-MG方法需要的内迭代次数是CG-SG方法的一半略多，
但时间上BiCGStab-MG明显要慢于CG-SG方法。
这是因为BiCGStab方法为了处理非对称的情况，
每轮内迭代中要比CG方法多做一次矩阵-向量乘法
操作\footnote{对角线预条件算法只需要做向量-向量乘法。}及其他运算
（见\floatref{alg:gpu.pcg}及\floatref{alg:gpu.pbicgstab}），
使得总计算时间大幅增加。
这说明计算大规模线性代数问题时，充分利用问题的特点（如实对称的矩阵性质）
可以加速计算过程。

GMRES能够求解方程类型更多，相应的每轮内迭代计算开销也更大，
而且本测试中并没有配合高效的预条件算法，所以GMRES相对BiCGStab来说效率更低，
但仍好于Jacobi算法。

\begin{table}
\centering
\caption{\label{tab:equsolve.iter.compare} 不同迭代算法对比}
\begin{tabular}{cccccc}
\toprule
\begin{tabular}{c}网格\\ 大小 \end{tabular}
  & 迭代算法 & 计算时间/s
  & \begin{tabular}{c}总内迭代\\ 次数 \end{tabular}
   & \begin{tabular}{c}外迭代\\ 次数 \end{tabular}
   & 参数\\
\midrule
\multirow{4}{*}{5cm}
  & Jacobi-SG   & 1.420 & 4802 & 343 & 内迭代7次\\
  & Jacobi-MG   & 1.295 & 2436 & 609 & 内迭代4次\\
  & CG-SG       & 0.920 & 1472 & 184 & 内迭代4次\\
  & BiCGStab-MG & 0.998 & 624 & 208 & 内迭代3次\\
  & GMRES-MG    & 1.061 & 1212 & 202 & 
    \begin{tabular}{c}内迭代6次，\\ Restart10 \end{tabular}\\
\multirow{4}{*}{2.5cm}
  & Jacobi-SG   & 9.048 & 16324 & 742 & 内迭代11次\\
  & Jacobi-MG   & 6.708 & 6512 & 814 & 内迭代8次\\
  & CG-SG       & 2.761 & 2800 & 200 & 内迭代7次\\
  & BiCGStab-MG & 4.056 & 1600 & 200 & 内迭代8次\\
  & GMRES-MG    & 4.852 & 2580 & 258 & 
    \begin{tabular}{c}内迭代10次，\\ Restart5 \end{tabular}\\
\multirow{4}{*}{2cm}
  & Jacobi-SG   & 22.948 & 25664 & 802 & 内迭代16次\\
  & Jacobi-MG   & 17.238 & 10010 & 910 & 内迭代11次\\
  & CG-SG       & 5.476 & 3700 & 185 & 内迭代10次\\
  & BiCGStab-MG & 8.954 & 2120 & 212 & 内迭代10次\\
  & GMRES-MG    & 12.277 & 3388 & 242 & 
    \begin{tabular}{c}内迭代14次，\\ Restart10 \end{tabular}\\
\multirow{4}{*}{1cm}
  & Jacobi-SG   & 509.309 & 96804 & 2689 & 内迭代18次\\
  & Jacobi-MG   & 332.083 & 31388 & 826 & 内迭代38次\\
  & CG-SG       & 48.875 & 7106 & 209 & 内迭代17次\\
  & BiCGStab-MG & 100.339 & 4305 & 205 & 内迭代21次\\
  & GMRES-MG    & 161.804 & 6264 & 232 & 
    \begin{tabular}{c}内迭代27次，\\ Restart15 \end{tabular}\\
\bottomrule
\end{tabular}

\end{table}
